--- libco.orig/ppc-elf.c	Sat Oct 10 22:11:16 2009
+++ libco/ppc-elf.c	Wed Oct 28 12:30:19 2009
@@ -66,9 +66,15 @@
 /*
  * co_active_context is either in a global offset table (if we are
  * compiling -fPIC or -fPIE) or has an absolute position.
+ *
+ * __attribute__((__used__)) is necessary because newer versions of
+ * gcc might replace co_active_context with an inline constant. This
+ * optimization would cause a linker error. This is because gcc cannot
+ * detect that our __asm__ uses co_active_context.
  */
 static void *co_main_stack_pointer;
-static cothread_t co_active_context = &co_main_stack_pointer;
+static cothread_t co_active_context __attribute__((__used__)) =
+  &co_main_stack_pointer;
 
 extern cothread_t co_active() {
   return co_active_context;
